---

- name: Install software required for kubernetes-the-hard-way
  apt:
    pkg:
      - rsync
      - dnsutils
    update_cache: yes

- name: Install battleshed private ssh key to admin users
  copy:
    src: /home/dant/.ssh/battleshed-aws
    dest: "/home/admin/.ssh/id_rsa"
    mode: 0600
    owner: "admin"
    group: "admin"

- name: Install battleshed private ssh key to root users
  copy:
    src: /home/dant/.ssh/battleshed-aws
    dest: "/root/.ssh/id_rsa"
    mode: 0600
    owner: "root"
    group: "root"

- name: Set hostname
  hostname:
    name: "{{ inventory_hostname_short }}"
    use: systemd

- name: Add Domain line to /etc/systemd/resolved.conf
  lineinfile:
    path: /etc/systemd/resolved.conf
    insertafter: '^\[Resolve\].*'
    line: "Domains=battleshed.uk kubernetes.local"
  notify:
    - Restart systemd-resolved